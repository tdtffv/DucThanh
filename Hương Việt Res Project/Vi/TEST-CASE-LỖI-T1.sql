/*Người thực hiện: Dương Khánh Vi, MSSV: 1712899, Mã nhóm: 8*/
USE HuongViet
-- Lỗi 1: Dirty Read
BEGIN TRAN
UPDATE THUCDON
SET SL_CONLAI = 0
WHERE MACN = 1 AND MAMON = 1
waitfor delay '00:00:10'
ROLLBACK
GO
-- Lỗi 2: Unrepeatable Read
BEGIN TRAN
SELECT * FROM THANHVIEN WHERE MATV = 1 
waitfor delay '00:00:15'
SELECT * FROM THANHVIEN WHERE MATV = 1 
COMMIT
GO
-- Lỗi 3: Lost update
BEGIN TRAN
SELECT DIACHI FROM THANHVIEN WHERE MATV = 1
waitfor delay '00:00:10'
UPDATE THANHVIEN
SET DIACHI = N'Khu đô thị Sala, phường 3, quận 2, TPHCM' WHERE MATV = 1
COMMIT
GO
-- Lỗi 4: Phantom
BEGIN TRAN
SELECT * FROM THANHVIEN WHERE CHINHANHDK = 2
waitfor delay '00:00:10'
SELECT * FROM THANHVIEN WHERE CHINHANHDK = 2
COMMIT
GO
-- Lỗi 5: Deadlock
BEGIN TRAN
set tran isolation level SERIALIZABLE
SELECT DIACHI FROM THANHVIEN WHERE MATV = 1
waitfor delay '00:00:10'
UPDATE THANHVIEN
SET DIACHI = N'Khu đô thị Sala, phường 3, quận 2, TPHCM' WHERE MATV = 1
COMMIT




































-- Lỗi 1: Dirty Read
BEGIN TRAN
UPDATE THUCDON
SET SL_CONLAI = 0
WHERE MACN = 1 AND MAMON = 1
waitfor delay '00:00:10'
ROLLBACK
